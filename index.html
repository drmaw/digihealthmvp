<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>DigiHealth Login</title>
</head>
<body>

<h2>DigiHealth Login</h2>

<input id="email" type="email" placeholder="Email"><br><br>
<input id="password" type="password" placeholder="Password"><br><br>
<button id="loginBtn">Login</button>

<p id="status"></p>

<script type="module">
import { auth } from "./js/firebase.js";
import { requireAuth } from "./js/auth.js";
import {
  signInWithEmailAndPassword
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  doc,
  getDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { db } from "./js/firebase.js";

const status = document.getElementById("status");

document.getElementById("loginBtn").onclick = async () => {
  status.innerText = "Logging in...";
  try {
    const email = email.value;
    const password = password.value;

    const res = await signInWithEmailAndPassword(auth, email, password);

    const snap = await getDoc(doc(db, "users", res.user.uid));
    if (!snap.exists()) {
      status.innerText = "User profile not found";
      return;
    }

    const role = snap.data().role_id;

    /* CENTRAL ROUTING */
    if (role === "admin") location.href = "/admin.html";
    else if (role === "doctor") location.href = "/doctor.html";
    else if (role === "manager") location.href = "/manager.html";
    else if (role === "assistant_manager") location.href = "/assistant_manager.html";
    else location.href = "/patient.html";

  } catch (e) {
    console.error(e);
    status.innerText = "Login failed";
  }
};
</script>

</body>
</html>
