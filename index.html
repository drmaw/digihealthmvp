<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>DigiHealth Login</title>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBqUDMQgc57d4wWSW2auFyYCS19q8vxBU4",
      authDomain: "digihealth-65f04.firebaseapp.com",
      projectId: "digihealth-65f04",
      storageBucket: "digihealth-65f04.appspot.com",
      messagingSenderId: "704628949252",
      appId: "1:704628949252:web:b38a476bd9c4259f829051"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.login = async function () {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (e) {
        alert(e.message);
      }
    };

    onAuthStateChanged(auth, async (user) => {
      if (!user) return;

      const snap = await getDoc(doc(db, "users", user.uid));
      if (!snap.exists()) {
        alert("User profile not found");
        auth.signOut();
        return;
      }

      const me = snap.data();
      const role = me.role_id;

      // ðŸ”´ THIS WAS MISSING BEFORE
      switch (role) {
        case "admin":
          location.href = "/admin.html";
          break;

        case "doctor":
          location.href = "/doctor.html";
          break;

        case "patient":
          location.href = "/patient.html";
          break;

        case "clinic_manager":
          location.href = "/manager.html";
          break;

        case "assistant_manager":
          location.href = "/assistant_manager.html";
          break;

        default:
          alert("Unauthorized role");
          auth.signOut();
      }
    });
  </script>
</head>

<body style="font-family: sans-serif">
  <h2>à¦²à¦—à¦‡à¦¨</h2>

  <input id="email" placeholder="à¦‡à¦®à§‡à¦‡à¦²" />
  <br /><br />
  <input id="password" type="password" placeholder="à¦ªà¦¾à¦¸à¦“à¦¯à¦¼à¦¾à¦°à§à¦¡" />
  <br /><br />
  <button onclick="login()">à¦²à¦—à¦‡à¦¨</button>
</body>
</html>
