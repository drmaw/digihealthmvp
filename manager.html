<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>ম্যানেজার ড্যাশবোর্ড</title>
</head>
<body>

<button id="logout">লগআউট</button>

<h2>ম্যানেজার ড্যাশবোর্ড</h2>

<h3>DigiHealth QR</h3>
<img id="qr" alt="DigiHealth QR Code" />

<hr>

<h3>হেলথ অপারেশন</h3>
<ul>
  <li><a href="/clinic/search.html">রোগী অনুসন্ধান</a></li>
  <li><a href="/clinic/appointments.html">অ্যাপয়েন্টমেন্ট ব্যবস্থাপনা</a></li>
</ul>

<h3>ক্লিনিক অপারেশন</h3>
<ul>
  <li><a href="/clinic/assign-staff.html">স্টাফ নিয়োগ</a></li>
  <li><a href="/billing.html">বিলিং</a></li>
</ul>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { generateProfileQR } from "./js/qr.js";

/* Firebase config */
const firebaseConfig = {
  apiKey: "AIzaSyBqUDMQgc57d4wWSW2auFyYCS19q8vxBU4",
  authDomain: "digihealth-65f04.firebaseapp.com",
  projectId: "digihealth-65f04",
  storageBucket: "digihealth-65f04.appspot.com",
  messagingSenderId: "704628949252",
  appId: "1:704628949252:web:b38a476bd9c4259f829051"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* Auth + role check */
onAuthStateChanged(auth, async (u) => {
  if (!u) {
    location.href = "/index.html";
    return;
  }

  const snap = await getDoc(doc(db, "users", u.uid));
  if (!snap.exists()) {
    location.href = "/index.html";
    return;
  }

  const me = snap.data();

  if (me.role_id !== "manager" && me.role_id !== "assistant_manager") {
    location.href = "/index.html";
    return;
  }

  // Generate manager QR
  generateProfileQR(
    document.getElementById("qr"),
    {
      digihealth_id: me.digihealth_id,
      role: me.role_id
    }
  );
});

/* Logout */
logout.onclick = async () => {
  await signOut(auth);
  location.href = "/index.html";
};
</script>

</body>
</html>
