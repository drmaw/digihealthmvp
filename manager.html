<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>DigiHealth ‚Äî Clinic Manager Dashboard</title>
</head>
<body>

<h2>Clinic Manager Dashboard</h2>

<div id="noOrgBox" style="display:none;">
  <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶® ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶®‡ßá‡¶á‡•§</p>
  <p>‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶® ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
  <a href="/organizations/create.html">Create Organization</a>
</div>

<div id="managerContent" style="display:none;">
  <nav>
    <ul>
      <li><a href="/organizations/dashboard.html">Organization Dashboard</a></li>
      <li><a href="/appointments/my.html">Appointments</a></li>
      <li><a href="/organizations/doctors.html">Doctors</a></li>
      <li><a href="/organizations/staff.html">Staff</a></li>
    </ul>
  </nav>

  <hr />

  <section>
    <h3>Organization Info</h3>
    <div id="orgInfo">Loading...</div>
  </section>
</div>

<hr />

<button id="logoutBtn">Logout</button>

<script type="module">
  import { requireAuth } from "/js/auth_guard.js";
  import { auth, db } from "/js/firebase.js";
  import { signOut } from
    "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { doc, getDoc } from
    "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // üîê Guard: Clinic Manager only
  requireAuth(["clinic_manager"], async (profile) => {

    // No organization yet
    if (!profile.organization_id) {
      document.getElementById("noOrgBox").style.display = "block";
      return;
    }

    document.getElementById("managerContent").style.display = "block";

    // Load organization info
    const snap = await getDoc(doc(db, "organizations", profile.organization_id));
    if (!snap.exists()) {
      document.getElementById("orgInfo").innerText = "‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø";
      return;
    }

    const org = snap.data();
    document.getElementById("orgInfo").innerHTML = `
      <p><b>Name:</b> ${org.name}</p>
      <p><b>Status:</b> ${org.status}</p>
      <p><b>Contact:</b> ${org.contact_phone || "-"}</p>
    `;
  });

  // Logout
  document.getElementById("logoutBtn").onclick = async () => {
    await signOut(auth);
    location.href = "/index.html";
  };
</script>

</body>
</html>
