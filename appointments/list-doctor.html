<!DOCTYPE html>
<html lang="bn">
<head><meta charset="UTF-8"><title>Doctor Appointments</title></head>
<body>

<h3>ডাক্তারের অ্যাপয়েন্টমেন্ট</h3>
<ul id="list"></ul>

<script type="module">
import { requireRole } from "../js/guard.js";
import { listAppointments, updateAppointmentStatus } from "../js/appointments.js";

const { user } = await requireRole(["doctor"]);
const appts = await listAppointments({ doctor_uid: user.uid });

appts.forEach(a => {
  const li = document.createElement("li");
  li.innerHTML = `
    ${a.status} — ${new Date(a.scheduled_at.seconds * 1000).toLocaleString()}
    <button data-id="${a.id}" data-s="completed">Complete</button>
    <button data-id="${a.id}" data-s="no_show">No Show</button>
  `;
  list.appendChild(li);
});

list.onclick = async e => {
  if (!e.target.dataset.id) return;
  await updateAppointmentStatus(e.target.dataset.id, e.target.dataset.s);
  location.reload();
};
</script>

</body>
</html>
