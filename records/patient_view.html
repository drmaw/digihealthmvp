<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>আমার মেডিকেল রেকর্ড</title>
</head>
<body>

<h2>আমার মেডিকেল রেকর্ড</h2>
<button id="logout">লগআউট</button>
<hr>

<div id="records">লোড হচ্ছে...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import {
  getFirestore,
  collection,
  query,
  where,
  getDocs,
  orderBy
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBQUDMQgc57d4wWSW2auFyYCS19q8vxBU4",
  authDomain: "digihealth-65f04.firebaseapp.com",
  projectId: "digihealth-65f04",
  storageBucket: "digihealth-65f04.appspot.com",
  messagingSenderId: "704628949252",
  appId: "1:704628949252:web:b38a476bd9c4259f829051"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const recordsBox = document.getElementById("records");
document.getElementById("logout").onclick = () => signOut(auth);

onAuthStateChanged(auth, async (user) => {
  if (!user) {
    location.href = "/index.html";
    return;
  }

  const q = query(
    collection(db, "patient_records"),
    where("patient_uid", "==", user.uid),
    orderBy("created_at", "desc")
  );

  const snap = await getDocs(q);

  if (snap.empty) {
    recordsBox.innerText = "কোনো রেকর্ড পাওয়া যায়নি";
    return;
  }

  recordsBox.innerHTML = "";

  snap.forEach(doc => {
    const d = doc.data();

    const div = document.createElement("div");
    div.style.border = "1px solid #ccc";
    div.style.padding = "10px";
    div.style.marginBottom = "10px";

    div.innerHTML = `
      <b>ধরন:</b> ${d.record_type}<br>
      <b>শিরোনাম:</b> ${d.title}<br>
      <b>নোট:</b> ${d.notes || "-"}<br>
      <b>দেখতে পারবে:</b> ${d.visibility}<br>
      <small>${d.created_at?.toDate().toLocaleString("bn-BD") || ""}</small>
    `;

    recordsBox.appendChild(div);
  });
});
</script>

</body>
</html>
