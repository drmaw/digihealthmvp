<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <title>রোগী অনুসন্ধান</title>
</head>
<body style="display:flex;gap:10px;">

<div id="sidebar"></div>

<main style="padding:10px;flex:1;">
  <h2>রোগী / ব্যবহারকারী অনুসন্ধান</h2>

  <input id="q" placeholder="ফোন নম্বর বা DigiHealth ID">
  <button id="btn">খুঁজুন</button>

  <pre id="out"></pre>
</main>

<script type="module">
import { requireClinicUser, searchUserGlobal } from "./clinic.js";
import { signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { auth } from "../js/firebase.js";

// sidebar
const sidebar = await fetch("/clinic/sidebar.html").then(r => r.text());
document.getElementById("sidebar").innerHTML = sidebar;

// auth
await requireClinicUser();

// search
btn.onclick = async () => {
  out.textContent = "অনুসন্ধান চলছে...";
  const res = await searchUserGlobal(q.value);

  if (!res || res.length === 0) {
    out.textContent = "কোনো তথ্য পাওয়া যায়নি";
    return;
  }

  out.textContent = JSON.stringify(res, null, 2);
};

// logout
document.getElementById("logout").onclick = async () => {
  await signOut(auth);
  location.href = "/index.html";
};
</script>

</body>
</html>
