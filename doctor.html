<!DOCTYPE html>
<html lang="bn">
<head><meta charset="UTF-8"><title>ডাক্তার</title></head>
<body>

<button id="logout">লগআউট</button>
<input id="q" placeholder="ফোন / হেলথ আইডি">
<button id="s">খুঁজুন</button>
<pre id="out"></pre>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBqUDMQgc57d4wWSW2auFyYCS19q8vxBU4",
  authDomain: "digihealth-65f04.firebaseapp.com",
  projectId: "digihealth-65f04",
  storageBucket: "digihealth-65f04.appspot.com",
  messagingSenderId: "704628949252",
  appId: "1:704628949252:web:b38a476bd9c4259f829051"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async u=>{
  const me = await getDoc(doc(db,"users",u.uid));
  if (me.data().role_id!=="doctor") location.href="/index.html";
});

logout.onclick=async()=>{await signOut(auth);location.href="/index.html"};

s.onclick=async()=>{
  out.textContent="";
  const snap=await getDocs(query(collection(db,"users"),
    where("role_id","==","patient"),
    where("phone","==",q.value)
  ));
  snap.forEach(d=>out.textContent+=JSON.stringify(d.data(),null,2));
};
</script>

</body>
</html>
