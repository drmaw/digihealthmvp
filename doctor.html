<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>DigiHealth ‚Äî Doctor Dashboard</title>
</head>
<body>

<h2>Doctor Dashboard</h2>

<div id="pendingBox" style="display:none;">
  <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶è‡¶ñ‡¶®‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶π‡ßü‡¶®‡¶ø‡•§</p>
  <p>‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶® ‡¶®‡¶æ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶™‡¶∞‡ßç‡¶Ø‡¶®‡ßç‡¶§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶∞‡ßã‡¶ó‡ßÄ‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶¨‡¶æ ‡¶≤‡¶ø‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§</p>
</div>

<div id="doctorContent" style="display:none;">
  <nav>
    <ul>
      <li><a href="/appointments/my.html">My Appointments</a></li>
      <li><a href="/records/doctor_view.html">Search Patient Records</a></li>
    </ul>
  </nav>

  <hr />

  <section>
    <h3>My Organizations</h3>
    <div id="orgList">Loading...</div>
  </section>
</div>

<hr />

<button id="logoutBtn">Logout</button>

<script type="module">
  import { requireAuth } from "/js/auth_guard.js";
  import { auth, db } from "/js/firebase.js";
  import { signOut } from
    "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import {
    collection,
    query,
    where,
    getDocs
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // üîê Guard: Doctor only
  requireAuth(["doctor"], async (profile) => {

    // If not approved yet
    if (profile.approved !== true) {
      document.getElementById("pendingBox").style.display = "block";
      return;
    }

    // Approved doctor
    document.getElementById("doctorContent").style.display = "block";

    // Load organizations where doctor practices
    const q = query(
      collection(db, "organization_doctors"),
      where("doctor_uid", "==", profile.uid)
    );

    const snap = await getDocs(q);

    if (snap.empty) {
      document.getElementById("orgList").innerText = "‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶®‡¶®";
      return;
    }

    let html = "<ul>";
    snap.forEach(doc => {
      const d = doc.data();
      html += `<li>${d.organization_id}</li>`;
    });
    html += "</ul>";

    document.getElementById("orgList").innerHTML = html;
  });

  // Logout
  document.getElementById("logoutBtn").onclick = async () => {
    await signOut(auth);
    location.href = "/index.html";
  };
</script>

</body>
</html>
