<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <title>DigiHealth â€” Admin Dashboard</title>
</head>
<body>

<h2>Admin Dashboard</h2>

<nav>
  <ul>
    <li><a href="/admin/approvals.html">Approvals</a></li>
    <li><a href="/admin/users.html">Users</a></li>
    <li><a href="/admin/representatives.html">Representatives</a></li>
    <li><a href="/admin/logs.html">Activity Logs</a></li>
  </ul>
</nav>

<hr />

<section id="stats">
  <h3>System Statistics</h3>
  <div id="statsBox">Loading...</div>
</section>

<hr />

<button id="logoutBtn">Logout</button>

<script type="module">
  import { requireAuth } from "/js/auth_guard.js";
  import { auth } from "/js/firebase.js";
  import { signOut } from
    "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getRoleStatistics } from "/js/admin_access.js";

  // ðŸ” Guard: Admin only
  requireAuth(["admin"], async (adminProfile) => {
    // Load stats
    const stats = await getRoleStatistics();

    document.getElementById("statsBox").innerHTML = `
      <p>Total Users: ${stats.total}</p>
      <p>Patients: ${stats.patient}</p>
      <p>Doctors: ${stats.doctor}</p>
      <p>Clinic Managers: ${stats.clinic_manager}</p>
      <p>Assistant Managers: ${stats.assistant_manager}</p>
      <p>Representatives: ${stats.representative}</p>
      <p>Admins: ${stats.admin}</p>
    `;
  });

  // Logout
  document.getElementById("logoutBtn").onclick = async () => {
    await signOut(auth);
    location.href = "/index.html";
  };
</script>

</body>
</html>
